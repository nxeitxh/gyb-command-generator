<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GYB Command Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
            color: #1f2937; /* Dark gray text */
        }
        .form-label {
            @apply block text-sm font-medium text-gray-700 mb-1;
        }
        .form-input, .form-select {
            @apply mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm 
                   focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm;
        }
        .form-input::placeholder {
            color: #9ca3af; 
        }
        .form-select option {
            background-color: #ffffff;
            color: #1f2937;
        }
        .form-checkbox {
            @apply h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500;
        }
        .group-hidden {
            display: none !important;
        }
        #generatedCommand {
            white-space: pre-wrap; 
            word-break: break-all; 
            font-family: 'Menlo', 'Monaco', 'Consolas', "Liberation Mono", "Courier New", monospace; /* Standard mono font */
        }
        .title-text {
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            color: #374151; /* Darker gray for title */
        }
        .main-container {
            background-color: #ffffff; /* White background for container */
            border: 1px solid #e5e7eb; /* Light border */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* Subtle shadow */
        }
        .copy-button-simple {
            @apply absolute top-2 right-2 bg-indigo-600 hover:bg-indigo-700 text-white 
                   text-xs py-1 px-3 rounded-md transition-all duration-150 ease-in-out
                   focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-75;
        }
        .command-output-box {
            @apply bg-gray-800 text-green-300 p-4 rounded-md shadow relative border border-gray-700;
        }
        .footer-text {
            @apply text-center text-xs text-gray-500;
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-2xl mx-auto p-6 md:p-8 rounded-lg main-container">
        <header class="mb-8">
            <h1 class="text-2xl text-center title-text">GYB Command Generator</h1>
        </header>

        <form id="gybForm" class="space-y-4">
            <div>
                <label for="osSelect" class="form-label">Operating System:</label>
                <select id="osSelect" class="form-select">
                    <option value="windows">Windows (.\gyb)</option>
                    <option value="linux">Linux/Mac (gyb)</option>
                </select>
            </div>

            <div>
                <label for="actionSelect" class="form-label">Action:</label>
                <select id="actionSelect" class="form-select">
                    <option value="backup">Backup</option>
                    <option value="restore">Restore</option>
                    <option value="estimate">Estimate</option>
                    <option value="purge">Purge</option>
                    <option value="create-project">Create Project</option>
                    <option value="check-service-account">Check Service Account</option>
                    <option value="revoke-service-account">Revoke Service Account</option>
                </select>
            </div>

            <div id="sourceEmailGroup">
                <label for="sourceEmailInput" id="sourceEmailLabel" class="form-label">Source Email Address:</label>
                <input type="email" id="sourceEmailInput" class="form-input" placeholder="user@example.com">
            </div>

            <div id="targetEmailGroup" class="group-hidden">
                <label for="targetEmailInput" class="form-label">Target Email Address (for Restore):</label>
                <input type="email" id="targetEmailInput" class="form-input" placeholder="target@example.com">
            </div>

            <div id="folderGroup" class="group-hidden">
                <label for="folderNameInput" id="folderNameLabel" class="form-label">Folder Name:</label>
                <input type="text" id="folderNameInput" class="form-input" placeholder="e.g., GYB-Backup-user@example.com">
                <p class="mt-1 text-xs text-gray-500">Default path generated from Source Email if blank.</p>
            </div>
            
            <div id="beforeDateGroup" class="group-hidden">
                <label for="beforeDateInput" class="form-label">Search: Before Date (YYYY/MM/DD):</label>
                <input type="date" id="beforeDateInput" class="form-input">
            </div>

            <div id="afterDateGroup" class="group-hidden">
                <label for="afterDateInput" class="form-label">Search: After Date (YYYY/MM/DD):</label>
                <input type="date" id="afterDateInput" class="form-input">
            </div>
            
            <div id="searchQueryGroup" class="group-hidden">
                <label for="searchQueryInput" class="form-label">Advanced Search Query (Optional):</label>
                <input type="text" id="searchQueryInput" class="form-input" placeholder="e.g., label:important has:attachment">
                <p class="mt-1 text-xs text-gray-500">Combines with date filters.</p>
            </div>


            <div id="removeLabelsGroup" class="flex items-center group-hidden">
                <input id="removeLabelsCheckbox" type="checkbox" class="form-checkbox">
                <label for="removeLabelsCheckbox" class="ml-2 block text-sm text-gray-700">Remove Labels (on Restore)</label>
            </div>

            <div id="addLabelRestoredGroup" class="flex items-center group-hidden">
                <input id="addLabelRestoredCheckbox" type="checkbox" class="form-checkbox">
                <label for="addLabelRestoredCheckbox" class="ml-2 block text-sm text-gray-700">Add Label to Restored Emails</label>
            </div>

            <div id="labelNameRestoredGroup" class="group-hidden">
                <label for="labelNameRestoredInput" class="form-label">Label to Add:</label>
                <input type="text" id="labelNameRestoredInput" class="form-input" placeholder="e.g., Restored-Backup">
            </div>

            <div class="flex items-center mt-1">
                <input id="useServiceAccountCheckbox" type="checkbox" class="form-checkbox">
                <label for="useServiceAccountCheckbox" class="ml-2 block text-sm text-gray-700">Use Service Account (--service-account)</label>
            </div>
        </form>

        <div class="mt-10">
            <h2 class="text-lg font-semibold text-gray-700 mb-3">Generated GYB Command:</h2>
            <div class="command-output-box">
                <pre id="generatedCommand">.\gyb --action backup --email source@example.com</pre>
                <button id="copyCommandButton" class="copy-button-simple">
                    Copy
                </button>
            </div>
            <div id="copyMessage" class="text-sm text-green-600 mt-2 h-4"></div>
        </div>

        <footer class="mt-10 footer-text">
            <p>Ensure GYB is installed and correctly configured in your environment.</p>
            <p>Verify the command before execution, especially for destructive actions like Purge.</p>
        </footer>
    </div>

    <script>
        // DOM Elements
        const osSelect = document.getElementById('osSelect');
        const actionSelect = document.getElementById('actionSelect');
        const sourceEmailInput = document.getElementById('sourceEmailInput');
        const sourceEmailLabel = document.getElementById('sourceEmailLabel');
        const targetEmailInput = document.getElementById('targetEmailInput');
        const folderNameInput = document.getElementById('folderNameInput');
        const folderNameLabel = document.getElementById('folderNameLabel');
        const beforeDateInput = document.getElementById('beforeDateInput');
        const afterDateInput = document.getElementById('afterDateInput');
        const searchQueryInput = document.getElementById('searchQueryInput');
        const removeLabelsCheckbox = document.getElementById('removeLabelsCheckbox');
        const addLabelRestoredCheckbox = document.getElementById('addLabelRestoredCheckbox');
        const labelNameRestoredInput = document.getElementById('labelNameRestoredInput');
        const useServiceAccountCheckbox = document.getElementById('useServiceAccountCheckbox');
        const generatedCommandPre = document.getElementById('generatedCommand');
        const copyCommandButton = document.getElementById('copyCommandButton');
        const copyMessage = document.getElementById('copyMessage');

        // Groups for visibility
        const sourceEmailGroup = document.getElementById('sourceEmailGroup');
        const targetEmailGroup = document.getElementById('targetEmailGroup');
        const folderGroup = document.getElementById('folderGroup');
        const beforeDateGroup = document.getElementById('beforeDateGroup');
        const afterDateGroup = document.getElementById('afterDateGroup');
        const searchQueryGroup = document.getElementById('searchQueryGroup');
        const removeLabelsGroup = document.getElementById('removeLabelsGroup');
        const addLabelRestoredGroup = document.getElementById('addLabelRestoredGroup');
        const labelNameRestoredGroup = document.getElementById('labelNameRestoredGroup');

        // Function to update form visibility based on selected action
        function updateFormVisibility() {
            const action = actionSelect.value;

            // Hide all optional groups first
            [targetEmailGroup, folderGroup, beforeDateGroup, afterDateGroup, searchQueryGroup, removeLabelsGroup, addLabelRestoredGroup, labelNameRestoredGroup].forEach(group => group.classList.add('group-hidden'));
            
            sourceEmailGroup.classList.toggle('group-hidden', action === 'create-project');

            if (action === 'backup') {
                folderGroup.classList.remove('group-hidden');
                folderNameLabel.textContent = 'Backup to Folder:';
                beforeDateGroup.classList.remove('group-hidden');
                afterDateGroup.classList.remove('group-hidden');
                searchQueryGroup.classList.remove('group-hidden');
                sourceEmailLabel.textContent = 'Source Email Address (to backup):';
            } else if (action === 'restore') {
                sourceEmailLabel.textContent = 'Source Email Address (of original backup):';
                targetEmailGroup.classList.remove('group-hidden');
                folderGroup.classList.remove('group-hidden');
                folderNameLabel.textContent = 'Restore from Folder:';
                removeLabelsGroup.classList.remove('group-hidden');
                addLabelRestoredGroup.classList.remove('group-hidden');
                if (addLabelRestoredCheckbox.checked) {
                    labelNameRestoredGroup.classList.remove('group-hidden');
                }
            } else if (action === 'estimate') {
                sourceEmailLabel.textContent = 'Source Email Address (to estimate):';
                beforeDateGroup.classList.remove('group-hidden');
                afterDateGroup.classList.remove('group-hidden');
                searchQueryGroup.classList.remove('group-hidden');
            } else if (action === 'purge') {
                sourceEmailLabel.textContent = 'Email Address to Purge From:';
                folderGroup.classList.remove('group-hidden');
                folderNameLabel.textContent = 'GYB Backup Folder (for deletion comparison):';
                beforeDateGroup.classList.remove('group-hidden');
                afterDateGroup.classList.remove('group-hidden');
                searchQueryGroup.classList.remove('group-hidden');
            } else if (action === 'check-service-account' || action === 'revoke-service-account') {
                sourceEmailLabel.textContent = 'Email Address for Service Account Action:';
            } else if (action === 'create-project') {
                // Most fields are hidden
            }
            generateCommand(); 
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            return dateString.replace(/-/g, '/');
        }

        function generateCommand() {
            const os = osSelect.value;
            const action = actionSelect.value;
            const sourceEmail = sourceEmailInput.value.trim();
            const targetEmail = targetEmailInput.value.trim();
            let folderName = folderNameInput.value.trim();
            const beforeDate = formatDate(beforeDateInput.value);
            const afterDate = formatDate(afterDateInput.value);
            const customSearch = searchQueryInput.value.trim();
            const removeLabels = removeLabelsCheckbox.checked;
            const addLabelRestored = addLabelRestoredCheckbox.checked;
            const labelNameRestored = labelNameRestoredInput.value.trim();
            const useServiceAccount = useServiceAccountCheckbox.checked;

            let gybExecutable = os === 'windows' ? '.\\gyb' : 'gyb';
            let commandParts = [gybExecutable];

            commandParts.push(`--action ${action}`);

            if (action === 'backup' || action === 'estimate' || action === 'check-service-account' || action === 'revoke-service-account' || action === 'purge') {
                if (sourceEmail) commandParts.push(`--email ${sourceEmail}`);
            } else if (action === 'restore') {
                if (targetEmail) commandParts.push(`--email ${targetEmail}`);
            }
            
            if (action === 'backup' || action === 'restore' || action === 'purge') {
                let effectiveFolder = folderName;
                if (!effectiveFolder && sourceEmail) { 
                    effectiveFolder = `GYB-Backup-${sourceEmail}`; // Standard default folder name
                }
                if (effectiveFolder) commandParts.push(`--local-folder "${effectiveFolder}"`);
            }

            if (action === 'backup' || action === 'estimate' || action === 'purge') {
                let searchClauses = [];
                if (afterDate) searchClauses.push(`after:${afterDate}`);
                if (beforeDate) searchClauses.push(`before:${beforeDate}`);
                if (customSearch) searchClauses.push(customSearch);
                
                if (searchClauses.length > 0) {
                    commandParts.push(`--search "${searchClauses.join(' ').trim()}"`);
                }
            }

            if (action === 'restore') {
                if (removeLabels) commandParts.push('--strip-labels');
                if (addLabelRestored && labelNameRestored) {
                    commandParts.push(`--label-restored "${labelNameRestored}"`);
                }
            }
            
            if (useServiceAccount) {
                commandParts.push('--service-account');
            }

            generatedCommandPre.textContent = commandParts.join(' ');
        }

        // Event Listeners
        [osSelect, actionSelect, sourceEmailInput, targetEmailInput, folderNameInput, beforeDateInput, afterDateInput, searchQueryInput, removeLabelsCheckbox, labelNameRestoredInput, useServiceAccountCheckbox].forEach(el => {
            const eventType = (el.type === 'checkbox' || el.tagName === 'SELECT' || el.type === 'date') ? 'change' : 'input';
            el.addEventListener(eventType, generateCommand);
        });
        
        actionSelect.addEventListener('change', updateFormVisibility);

        addLabelRestoredCheckbox.addEventListener('change', () => {
            if (actionSelect.value === 'restore') {
                 labelNameRestoredGroup.classList.toggle('group-hidden', !addLabelRestoredCheckbox.checked);
            }
            generateCommand();
        });

        copyCommandButton.addEventListener('click', () => {
            const commandText = generatedCommandPre.textContent;
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = commandText;
            tempTextArea.style.position = 'absolute'; 
            tempTextArea.style.left = '-9999px';
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            try {
                document.execCommand('copy');
                copyMessage.textContent = 'Command Copied!';
                copyMessage.classList.remove('text-red-500');
                copyMessage.classList.add('text-green-600');
            } catch (err) {
                copyMessage.textContent = 'Copy Failed. Please copy manually.';
                copyMessage.classList.remove('text-green-600');
                copyMessage.classList.add('text-red-500');
                console.error('Fallback: Unable to copy command', err);
            }
            document.body.removeChild(tempTextArea);
            setTimeout(() => { copyMessage.textContent = ''; }, 3000);
        });

        // Initial setup
        updateFormVisibility(); 
        
        if (window.location.search.includes('loadExample')) {
            osSelect.value = 'windows';
            actionSelect.value = 'restore';
            sourceEmailInput.value = 'rauter@lcpmd.com'; 
            targetEmailInput.value = 'byers@lcpmd.com'; 
            removeLabelsCheckbox.checked = true;
            addLabelRestoredCheckbox.checked = true;
            labelNameRestoredInput.value = 'rauter@lcpmd.com'; 
            useServiceAccountCheckbox.checked = true;
            updateFormVisibility(); 
        }
    </script>
</body>
</html>
